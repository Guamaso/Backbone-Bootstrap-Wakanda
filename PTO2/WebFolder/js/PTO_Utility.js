var PTO = (function() {	var ptoUtilObj = {}; //This is the object we will return to create our module.	//P R I V A T E   M E T H O D S   (S T A R T).    //P R I V A T E   M E T H O D S   (E N D).            //Backbone Objects.    ptoUtilObj.Models = {};     ptoUtilObj.Collections = {};     ptoUtilObj.Views = {};     ptoUtilObj.Router = {};     //Other stuff.    ptoUtilObj.Utility = {};     //Basic Pub Sub model.    //May be useful in our Backbone router.    ptoUtilObj.vent = _.extend({}, Backbone.Events);    ptoUtilObj.setCalendar = function(requestDateInput$, dayName$) {        // requestDateInput$ is the jQuery ref to our date input element.        // dayName$ is a jQuery ref to the day name label that is appended to our date input field.        PTO.holidayCollection.fetch({            success: function(theHolidayCollection) {                PTO.requestCollection.fetch({                    success: function(theRequestCollection) {                        var holidaysArr = theHolidayCollection.toJSON().map(function(oneDay) {return oneDay.dateString;});                        var requestsArr = theRequestCollection.toJSON().map(function(oneDay) {return oneDay.dateString;});                        //instantiate our date picker.                        requestDateInput$.datepicker("destroy");                        requestDateInput$.datepicker({                            beforeShowDay: function(date){                                var holidayDateString = jQuery.datepicker.formatDate('mm/dd/yy', date);                                if ((date.getDay() === 6) || (date.getDay() === 0)) {                                    //Weekends are not selectable.                                    return [false];                                } else if (holidaysArr.indexOf(holidayDateString) !== -1) {                                    //Neither are holidays.                                    return [false, 'holiday'];                                  } else if (requestsArr.indexOf(holidayDateString) !== -1) {                                    //Neither are holidays.                                    return [false, 'vacation'];                                 } else {                                    return [true];                                }                            },                            onSelect: function(dateSelectedStr, datePickerObj) {                                dayName$.html(moment(dateSelectedStr).format('dddd'));                                //PTO.dayName$.html(moment(dateSelectedStr).format('dddd'));                            }                        }); //end - $( "#requestDate" ).datepicker().                        //Skip holidays, weekends, and current requests.                        var keepLooking = true;                        var currentDayMoment = moment();                                                while (keepLooking) {                            if (holidaysArr.indexOf(currentDayMoment.format("MM/DD/YYYY")) !== -1) {                                    currentDayMoment.add('days', 1);                            } else if (requestsArr.indexOf(currentDayMoment.format("MM/DD/YYYY")) !== -1) {                                    currentDayMoment.add('days', 1);                            } else if (currentDayMoment.day() == 5) {                                    currentDayMoment.add('days', 2);                            } else if (currentDayMoment.day() == 0) {                                    currentDayMoment.add('days', 1);                            } else {                                    keepLooking = false;                            }                          } //end while()                        requestDateInput$.val(currentDayMoment.format("MM/DD/YYYY"));                        dayName$.html(currentDayMoment.format('dddd'));                    } //end - PTO.requestCollection.fetch({success()}).                }); //end - PTO.requestCollection.fetch();            } //end - PTO.holidayCollection.fetch({success()}).        }); //end - PTO.holidayCollection.fetch();    }; //end - setCalendar();    ptoUtilObj.wakandaQueryURLString = function (configObj) {        var urlString = "rest/" + configObj.dataClass + "/";        urlString += "?$top=" + configObj.top;        urlString += "&$filter='" + encodeURIComponent(configObj.filter) + "'";        urlString += encodeURI("&$params='[");        //Build params.        var parmsString = "";        for(var arg = 1, len = arguments.length; arg < len; ++ arg) {            var parm = arguments[arg];            if (_.isString(parm)) {                parmsString += "\"" + parm + "\"";            } else if (_.isNumber(parm)) {            } else if (_.isDate(parm)) {                parmsString += "\"" + moment().format() + "\"";            }            if (arg < len -1) {               parmsString += ",";             }        } //end - for.        urlString += encodeURIComponent(parmsString);        urlString += encodeURI("]'");        // urlString += encodeURI("&$params='[") + encodeURIComponent(configObj.params) + encodeURI("]'");        urlString += "&$method=entityset&$timeout=" + configObj.timeout;        //Hack Refactor        if (configObj.dataClass == "Request") {urlString += "&$expand=owner, owner.myManager";}                return urlString;    }	return ptoUtilObj;   }()); //end - PTO.